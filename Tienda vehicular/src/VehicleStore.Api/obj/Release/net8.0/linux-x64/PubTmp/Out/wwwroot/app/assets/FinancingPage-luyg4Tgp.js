import{r as x,j as e}from"./index-BEvnYS48.js";import{d as R,e as E}from"./api-DUm3p9eQ.js";function l(r){return isFinite(r)?"RD$ "+Math.round(r).toLocaleString("es-DO"):"RD$ 0"}function T(){const r=location.hash||"",o=r.includes("?")?r.split("?")[1]:"",a=o?new URLSearchParams(o).get("id"):null,h=new URLSearchParams(location.search).get("id");return a||h}function D(){const r=T(),o=localStorage.getItem("lastVehicleId");return r||o||"veh-001"}function O(r){const o=r.apr/100/12,a=r.balloon/100*r.price,h=Math.max(r.price-r.downPayment-a,0),c=Math.max(1,r.term),u=o>0?h*(o*Math.pow(1+o,c))/(Math.pow(1+o,c)-1):h/c,b=(r.commission.type==="percent"?r.price*(r.commission.value/100):r.commission.value)/c,g=r.itbisOnCommission?b*.18:0,N=u+r.insurance+b+g,t=[];let n=h;for(let p=1;p<=c;p++){const i=n*o,j=Math.max(u-i,0);n=Math.max(n-j,0),t.push({m:p,interest:i,principal:j,base:u,insurance:r.insurance,balance:n})}const f=t.reduce((p,i)=>p+i.interest,0),v=r.insurance*c,y=N*c+r.downPayment+a;return{r:o,principal:h,base:u,monthlyPayment:N,totalLoanCost:y,schedule:t,summary:{effectiveMonthlyRate:o*100,totalInterests:f,totalInsurance:v,totalCommission:b*c+g*c}}}function H(){const[r,o]=x.useState(()=>D()),[a,h]=x.useState(null),[c,u]=x.useState([]),[C,b]=x.useState(!0),[g,N]=x.useState(null),[t,n]=x.useState({price:0,downPayment:0,downPaymentPercent:0,term:24,apr:22,commission:{type:"percent",value:1},insurance:9e3,balloon:0,itbisOnCommission:!1});x.useEffect(()=>{const s=()=>o(D());return window.addEventListener("hashchange",s),()=>window.removeEventListener("hashchange",s)},[]),x.useEffect(()=>{let s=!0;return(async()=>{try{b(!0),N(null);let d=r||"veh-001",m=null;try{m=await R(d)}catch{if(d!=="veh-001")m=await R("veh-001"),d="veh-001";else throw new Error("No se pudo cargar el vehículo")}if(!s||!m)return;o(d),h(m),localStorage.setItem("lastVehicleId",m.id);const $=Number(m.price)||0,F=20,V=Math.round($*(F/100));n(P=>({...P,price:$,downPayment:V,downPaymentPercent:F})),E(m.id).then(P=>s&&u(P||[])).catch(()=>{})}catch(d){s&&N((d==null?void 0:d.message)||"Error cargando")}finally{s&&b(!1)}})(),()=>{s=!1}},[r]);const{principal:f,base:v,monthlyPayment:y,totalLoanCost:p,schedule:i,summary:j}=O(t),[S,L]=x.useState(!1),k=S?i:i.slice(0,6),[w,B]=x.useState(0),I=(a==null?void 0:a.photos)||[],A=s=>{s=Math.max(0,s);const d=t.price?s/t.price*100:0;n({...t,downPayment:s,downPaymentPercent:d})},M=s=>{s=Math.min(80,Math.max(0,s));const d=Math.round(t.price*(s/100));n({...t,downPayment:d,downPaymentPercent:s})};return C?e.jsx("div",{className:"container mx-auto px-4 py-10",children:"Cargando financiamiento…"}):g?e.jsxs("div",{className:"container mx-auto px-4 py-10",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"No se pudo cargar"}),e.jsx("p",{className:"text-[--muted] mt-2",children:g}),e.jsx("a",{href:"#/home",className:"inline-block mt-4 px-4 py-2 rounded-xl bg-[--primary] text-[--primary-contrast]",children:"Volver al inicio"})]}):a?e.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-10",children:[e.jsxs("nav",{className:"text-sm text-[--muted] flex items-center gap-2",children:[e.jsx("a",{href:"#/home",className:"hover:text-[--text]",children:"Inicio"}),e.jsx("span",{children:"›"}),e.jsx("span",{children:"Catálogo"}),e.jsx("span",{children:"›"}),e.jsxs("span",{className:"text-[--text]",children:[a.brand," ",a.model]}),e.jsx("span",{children:"›"}),e.jsx("span",{className:"text-[--text] font-medium",children:"Financiar"})]}),e.jsxs("header",{className:"rounded-2xl border border-[--border] bg-[--surface] p-5 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl bg-[--bg] border border-[--border] grid place-items-center text-[--muted]",children:I[w]?e.jsx("img",{src:I[w],alt:`${a.brand} ${a.model} ${w+1}`,className:"w-full h-[50px] md:h-[50px] object-cover"}):e.jsx("div",{className:"w-full h-[260px] md:h-[360px] grid place-items-center text-[--muted]",children:"Sin fotos"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl md:text-2xl font-bold",children:[a.brand," ",a.model," ",a.year]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[a.condition&&e.jsx("span",{className:`px-2 py-0.5 rounded-lg text-xs border ${a.condition==="Nuevo"?"bg-[--success]/15 text-[--success] border-transparent":"bg-[--muted]/15 text-[--muted] border-transparent"}`,children:a.condition}),a.isFinanceable&&e.jsx("span",{className:"px-2 py-0.5 rounded-lg text-xs border bg-[--primary]/15 text-[--primary] border-transparent",children:"Financiable"})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-[--muted]",children:"Precio"}),e.jsxs("div",{className:"text-2xl font-extrabold",children:["RD","$ ",Number(a.price).toLocaleString("es-DO")]}),e.jsxs("div",{className:"flex gap-2 mt-3 justify-end",children:[e.jsx("a",{href:"javascript:history.back()",className:"px-3 py-2 rounded-xl border border-[--border]",children:"↩ Volver"}),e.jsx("a",{href:"#/home",className:"px-3 py-2 rounded-xl border border-[--border]",children:"Cambiar vehículo"})]})]})]}),e.jsxs("section",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"rounded-2xl border border-[--border] bg-[--surface] p-5 space-y-4",children:[e.jsxs("h3",{className:"font-semibold p-2",children:[e.jsx("span",{className:"material-symbols-outlined text-[--muted] text-sm px-2",children:"calculate"}),"Calculadora de Financiamiento"]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-[--muted]",children:"Precio del Vehículo (RD$)"}),e.jsx("input",{type:"number",value:t.price,onChange:s=>n({...t,price:parseFloat(s.target.value)||0}),className:"rounded-xl border border-[--border] bg-[--bg] px-3 py-2 w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-[--muted]",children:"Inicial"}),e.jsxs("div",{className:"text-xs flex justify-between text-[--muted]",children:[e.jsxs("span",{children:["Porcentaje: ",t.downPaymentPercent.toFixed(1),"%"]}),e.jsxs("span",{children:["Monto: ",l(t.downPayment)]})]}),e.jsx("input",{type:"range",min:0,max:80,step:.5,value:t.downPaymentPercent,onChange:s=>M(parseFloat(s.target.value)),className:"w-full"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-[--muted] mb-1",children:"Monto (RD$)"}),e.jsx("input",{type:"number",value:t.downPayment,onChange:s=>A(parseFloat(s.target.value)||0),className:"rounded-xl border border-[--border] bg-[--bg] px-3 py-2 w-full"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-[--muted] mb-1",children:"Porcentaje (%)"}),e.jsx("input",{type:"number",min:0,max:80,step:.5,value:t.downPaymentPercent,onChange:s=>M(parseFloat(s.target.value)||0),className:"rounded-xl border border-[--border] bg-[--bg] px-3 py-2 w-full"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs text-[--muted]",children:"Plazo (meses)"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[12,18,24,36,48,60].map(s=>e.jsxs("button",{type:"button",onClick:()=>n({...t,term:s}),className:`px-3 py-1.5 rounded-lg border text-sm ${t.term===s?"bg-[--primary] text-[--primary-contrast] border-transparent":"bg-[--bg] border-[--border] hover:bg-[--bg]/80"}`,children:[s," meses"]},s))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-[--muted]",children:"Tasa APR Anual (%)"}),e.jsx("input",{type:"number",value:t.apr,min:0,max:60,step:.1,onChange:s=>n({...t,apr:parseFloat(s.target.value)||0}),className:"rounded-xl border border-[--border] bg-[--bg] px-3 py-2 w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-xs text-[--muted]",children:"Comisión"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-[--muted]",children:[e.jsx("button",{type:"button",onClick:()=>n({...t,commission:{...t.commission,type:"percent"}}),className:`px-2 py-1 rounded-md border ${t.commission.type==="percent"?"bg-[--surface]":"bg-[--bg] border-[--border]"}`,children:"%"}),e.jsx("button",{type:"button",onClick:()=>n({...t,commission:{...t.commission,type:"amount"}}),className:`px-2 py-1 rounded-md border ${t.commission.type==="amount"?"bg-[--surface]":"bg-[--bg] border-[--border]"}`,children:"RD$"})]})]}),e.jsx("input",{type:"number",value:t.commission.value,onChange:s=>n({...t,commission:{...t.commission,value:parseFloat(s.target.value)||0}}),className:"rounded-xl border border-[--border] bg-[--bg] px-3 py-2 w-full",placeholder:t.commission.type==="percent"?"1":"25000"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-[--muted]",children:"Seguro Mensual (RD$)"}),e.jsx("input",{type:"number",value:t.insurance,onChange:s=>n({...t,insurance:parseFloat(s.target.value)||0}),className:"rounded-xl border border-[--border] bg-[--bg] px-3 py-2 w-full"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs text-[--muted]",children:"Balloon (%)"}),e.jsx("input",{type:"number",value:t.balloon,min:0,max:40,step:.1,onChange:s=>n({...t,balloon:parseFloat(s.target.value)||0}),className:"rounded-xl border border-[--border] bg-[--bg] px-3 py-2 w-full"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:t.itbisOnCommission,onChange:s=>n({...t,itbisOnCommission:s.target.checked})}),"Incluir ITBIS en comisiones"]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{className:"flex-1 px-4 py-2 rounded-xl bg-[--primary] text-[--primary-contrast]",onClick:()=>n({...t}),children:"Calcular"}),e.jsx("button",{className:"px-4 py-2 rounded-xl border border-[--border]",onClick:()=>n({...t,downPayment:Math.round(t.price*.2),downPaymentPercent:20,term:24,apr:22,commission:{type:"percent",value:1},insurance:9e3,balloon:0,itbisOnCommission:!1}),children:"Limpiar"})]})]}),e.jsxs("div",{className:"rounded-2xl border border-[--border] bg-[--surface] p-5",children:[e.jsxs("h3",{className:"font-semibold gap-2 mb-4 p-2",children:[e.jsx("span",{className:"material-symbols-outlined text-[--muted] text-sm px-2",children:"trending_up"}),"Cuota Estimada"]}),e.jsxs("div",{className:"rounded-xl bg-[--bg] border border-[--border] p-6 text-center py-6",children:[e.jsx("div",{className:"text-m text-[--muted]",children:"Cuota mensual estimada"}),e.jsx("div",{className:"text-4xl md:text-4xl font-extrabold mt-5",children:l(y)}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mt-5 text-center align-center",children:[e.jsxs("div",{className:"rounded-lg border border-[--border] p-3",children:[e.jsx("div",{className:"text-s text-[--muted]",children:"Tasa efectiva mensual"}),e.jsxs("div",{className:"font-semibold text-center text-xl",children:[j.effectiveMonthlyRate.toFixed(2),"%"]})]}),e.jsxs("div",{className:"rounded-lg border border-[--border] p-3",children:[e.jsx("div",{className:"text-s text-[--muted]",children:"Total a financiar"}),e.jsx("div",{className:"font-semibold text-xl",children:l(f)})]}),e.jsxs("div",{className:"rounded-lg border border-[--border] p-3",children:[e.jsx("div",{className:"text-s text-[--muted]",children:"Total a préstar"}),e.jsx("div",{className:"font-semibold text-xl",children:l(p)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-6 text-center",children:[e.jsxs("div",{className:"rounded-lg border border-[--border] p-3",children:[e.jsx("div",{className:"text-xs text-[--muted]",children:"Capital aprox. (1er mes)"}),e.jsx("div",{className:"font-semibold",children:l(Math.max(v-f*(t.apr/100/12),0))})]}),e.jsxs("div",{className:"rounded-lg border border-[--border] p-3",children:[e.jsx("div",{className:"text-xs text-[--muted]",children:"Intereses (1er mes)"}),e.jsx("div",{className:"font-semibold",children:l(f*(t.apr/100/12))})]}),e.jsxs("div",{className:"rounded-lg border border-[--border] p-3",children:[e.jsx("div",{className:"text-xs text-[--muted]",children:"Seguro"}),e.jsx("div",{className:"font-semibold",children:l(t.insurance)})]}),e.jsxs("div",{className:"rounded-lg border border-[--border] p-3",children:[e.jsx("div",{className:"text-xs text-[--muted]",children:"Comisión prorrateada"}),e.jsx("div",{className:"font-semibold",children:l((t.commission.type==="percent"?t.price*t.commission.value/100:t.commission.value)/t.term)})]})]}),e.jsx("p",{className:"text-[--muted] text-xs mt-4",children:"* Simulación referencial sujeta a aprobación crediticia. Las condiciones finales pueden variar."})]})]})]}),e.jsxs("section",{className:"rounded-2xl border border-[--border] bg-[--surface] p-5",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Tabla de Amortización"}),e.jsx("div",{className:"overflow-x-auto rounded-xl border border-[--border]",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-[--bg]",children:e.jsxs("tr",{className:"[&>th]:px-3 [&>th]:py-2 text-left",children:[e.jsx("th",{children:"Mes"}),e.jsx("th",{children:"Interés"}),e.jsx("th",{children:"Capital"}),e.jsx("th",{children:"Cuota Base"}),e.jsx("th",{children:"Seguro"}),e.jsx("th",{children:"Saldo"})]})}),e.jsx("tbody",{children:k.map(s=>e.jsxs("tr",{className:"border-t border-[--border] [&>td]:px-3 [&>td]:py-2",children:[e.jsx("td",{children:s.m}),e.jsx("td",{children:l(s.interest)}),e.jsx("td",{children:l(s.principal)}),e.jsx("td",{children:l(s.base)}),e.jsx("td",{children:l(s.insurance)}),e.jsx("td",{children:l(s.balance)})]},s.m))})]})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mt-4",children:[e.jsxs("div",{className:"text-sm text-[--muted]",children:["Total de Intereses: ",e.jsx("span",{className:"font-semibold text-[--text]",children:l(j.totalInterests)})]}),e.jsxs("div",{className:"text-sm text-[--muted]",children:["Total de Seguros: ",e.jsx("span",{className:"font-semibold text-[--text]",children:l(j.totalInsurance)})]}),e.jsxs("div",{className:"text-sm text-[--muted]",children:["Última Cuota: ",e.jsx("span",{className:"font-semibold text-[--text]",children:l(i.length?i[i.length-1].base:0)})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{className:"text-[--primary] hover:underline text-sm",onClick:()=>L(s=>!s),children:S?"Ver solo 6 filas":`Ver tabla completa (${i.length} pagos)`})})]}),e.jsxs("section",{className:"rounded-2xl border border-[--border] bg-[--surface] p-8 text-center space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"¿Listo para financiar tu vehículo?"}),e.jsx("p",{className:"text-[--muted]",children:"Obtén una respuesta rápida y comienza el proceso hoy mismo."}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("a",{className:"px-4 py-2 rounded-xl bg-[--primary] text-[--primary-contrast]",href:"#/contact",children:"Solicitar financiamiento"}),e.jsx("a",{className:"px-4 py-2 rounded-xl border border-[--border]",target:"_blank",href:"https://wa.me/18090000000",rel:"noreferrer",children:"Continuar por WhatsApp"})]})]}),Array.isArray(c)&&c.length>0&&e.jsxs("section",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"También te puede interesar"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:c.map(s=>{var d,m;return e.jsxs("a",{href:`#/vehicle?id=${s.id}`,className:"rounded-2xl border border-[--border] bg-[--surface] p-3 hover:border-[--primary]",children:[e.jsx("div",{className:"aspect-video w-full rounded-xl bg-[--bg] overflow-hidden mb-2",children:(d=s.photos)!=null&&d[0]?e.jsx("img",{src:s.photos[0],alt:`${s.brand} ${s.model}`,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full grid place-items-center text-[--muted]",children:"Sin foto"})}),e.jsxs("div",{className:"text-sm font-semibold",children:[s.brand," ",s.model," ",s.year]}),e.jsx("div",{className:"text-xs text-[--muted]",children:(m=s.type)==null?void 0:m.toUpperCase()}),e.jsxs("div",{className:"text-sm font-bold mt-1",children:["RD$ ",Number(s.price).toLocaleString("es-DO")]})]},s.id)})})]})]}):null}export{H as default};
